<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Private Diary</title>

<style>
body {
  font-family: system-ui, sans-serif;
  margin: 16px;
}
input, select, textarea, button {
  width: 100%;
  margin-bottom: 8px;
  padding: 8px;
}
.entry {
  border-bottom: 1px solid #ccc;
  padding: 6px 0;
}
</style>
</head>

<body>

<h2>ğŸ““ Private Diary</h2>

<button id="loginBtn">Googleã§ãƒ­ã‚°ã‚¤ãƒ³</button>

<div id="app" style="display:none">
  <label>æ—¥ä»˜</label>
  <input type="date" id="date">

  <label>æ°—åˆ†</label>
  <select id="mood">
    <option value="5">ğŸ˜€ æœ€é«˜</option>
    <option value="4">ğŸ™‚ è‰¯ã„</option>
    <option value="3">ğŸ˜ æ™®é€š</option>
    <option value="2">ğŸ™ å¾®å¦™</option>
    <option value="1">ğŸ˜« ã—ã‚“ã©ã„</option>
  </select>

  <label>ä¸€è¨€æ—¥è¨˜</label>
  <textarea id="text" rows="3"></textarea>

  <button onclick="saveDiary()">ä¿å­˜</button>

  <h3>å±¥æ­´</h3>
  <div id="list"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, doc, setDoc, getDocs, collection } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

const firebaseConfig = {
  apiKey: "ã“ã“",
  authDomain: "ã“ã“",
  projectId: "ã“ã“",
  appId: "ã“ã“"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);
const provider = new GoogleAuthProvider();

const loginBtn = document.getElementById("loginBtn");
const appDiv = document.getElementById("app");
const dateInput = document.getElementById("date");
const moodInput = document.getElementById("mood");
const textInput = document.getElementById("text");
const list = document.getElementById("list");

dateInput.valueAsDate = new Date();

loginBtn.onclick = () => signInWithPopup(auth, provider);

onAuthStateChanged(auth, user => {
  if (user) {
    loginBtn.style.display = "none";
    appDiv.style.display = "block";
    loadList(user.uid);
    window.currentUser = user;
  }
});

async function saveDiary() {
  const u = window.currentUser;
  await setDoc(
    doc(db, "diaries", u.uid, "dates", dateInput.value),
    { mood: moodInput.value, text: textInput.value }
  );
  loadList(u.uid);
}

async function loadList(uid) {
  list.innerHTML = "";
  const qs = await getDocs(collection(db, "diaries", uid, "dates"));
  qs.forEach(d => {
    const e = d.data();
    const div = document.createElement("div");
    div.className = "entry";
    div.innerHTML = `<strong>${d.id}</strong> [${e.mood}]<br>${e.text}`;
    div.onclick = () => {
      dateInput.value = d.id;
      moodInput.value = e.mood;
      textInput.value = e.text;
    };
    list.appendChild(div);
  });
}

window.saveDiary = saveDiary;
</script>

</body>
</html>
