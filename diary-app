<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, doc, setDoc, getDocs, collection } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

// ★ここに Firebase の設定を貼る
const firebaseConfig = {
  apiKey: "ここ",
  authDomain: "ここ",
  projectId: "ここ",
  storageBucket: "ここ",
  messagingSenderId: "ここ",
  appId: "ここ"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const dateInput = document.getElementById("date");
const moodInput = document.getElementById("mood");
const textInput = document.getElementById("text");
const list = document.getElementById("list");

dateInput.valueAsDate = new Date();

async function saveDiary() {
  await setDoc(doc(db, "diaries", dateInput.value), {
    mood: moodInput.value,
    text: textInput.value
  });
  loadList();
}

async function loadList() {
  list.innerHTML = "";
  const querySnapshot = await getDocs(collection(db, "diaries"));
  querySnapshot.forEach(docSnap => {
    const d = docSnap.data();
    const div = document.createElement("div");
    div.className = "entry";
    div.innerHTML = `<strong>${docSnap.id}</strong> [${d.mood}]<br>${d.text}`;
    div.onclick = () => loadDiary(docSnap.id, d);
    list.appendChild(div);
  });
}

function loadDiary(date, d) {
  dateInput.value = date;
  moodInput.value = d.mood;
  textInput.value = d.text;
}

window.saveDiary = saveDiary;
loadList();
</script>
